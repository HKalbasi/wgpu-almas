# نمایش یک الماس با wgpu

## علت استفاده از wgpu

کتاب خانه
wgpu
یک کتاب خانه سطح پایین برای کار با جی پی یو است که توسط پروژه موزیلا فایرفاکس برای
پشتیبانی از وب جی پی یو در این مرورگر ساخته شده است. مزیت این کتاب خانه امنیت حافظه
آن (که در کنار زبان راسط می تواند از خطا های حافظه
به طور کامل جلوگیری کند)، پشتیبانی از سکو های بیشتر مثل مک و ویندوز و وب، قابلیت های محاسباتی و
GPGPU
که البته هیچ کدام در این پروژه باعث سادگی بیشتر نمی شوند و به همین دلیل ما پس از هماهنگی با دستیاران
آموزشی به جای
OpenGL
از این کتاب خانه استفاده کردیم تا کار با این کتاب خانه مدرن را یاد بگیریم.

## کشیدن الماس

در این پروژه ما ابتدا الماس را به یک سری مثلث تقسیم می کنیم. تقسیم کردن به مثلث ها
با یک کد ساده انجام می شود که ابتدا دو دایره در نظر می گیریم و سپس این دو دایره را
به هم مثلث بندی می کنیم و بعد از دایره پایین به نقطه پایینی الماس مثلث ها را رسم می کنیم
و بعد دایره بالایی را هم همه را به نقطه مرکز دایره وصل می کنیم تا در بالا یک سطح صاف پدید آید. برای
سطح صاف بالا همه از یک تسکتچر استفاده می کنیم ولی برای مثلث های دیگر از تکستچر تصادفی استفاده می کنیم و
بعضی از مثلث ها را به صورت تصادفی به مثلث های کوچکتر تقسیم می کنیم به امید این که به تصویر پی دی اف
نزدیک تر شویم. برای تهیه تسکچر ها نیز ما از روی پی دی اف اسکرین شات گرفتیم.

## دوربین

برای دوربین ما از کریت
`cgmath`
استفاده کردیم که یک استراکت دوربین در اختیار ما قرار می دهد و می تواند با گرفتن موقعیت دوربین و
موقعیت هدف و بردار دید بالا، ماتریس چهارتایی لازم برای تبدیل مختصات ها در یک پرسپکتیو را به ما
تحویل دهد. برای جا به جا کردن موقعیت بیننده مختصات را جا به جا می کنیم و برای زوم کردن
دوربین را در راستای خط واصل بین الماس و دوربین جلو و عقب می بریم.

برای چرخش ما تلاش می کنیم تا در هر گام چرخش، فاصله از الماس را ثابت نگه داریم. به این ترتیب
بدون این که نیازی به محاسبات قطبی و مثلثاتی داشته باشیم، انگار با یک نخ به الماس وصل هستیم
و حول آن دوران می کنیم.

## رسم

در این جا ما از
wgpu
استفاده می کنیم و اطلاعات هر مثلث را در یک بافر می ریزیم و یک سری کد برای تبدیل
استراکت های راسط به آرایه ای از بایت ها با استفاده از کریت
`bytemuck`
می زنیم و سپس هر مثلث را با استفاده از شیدری که به زبان
wgsl
نوشته شده است در صفحه رسم می کنیم.

## نور پردازی

از Ray Tracing استفاده نمی کنیم چون در این پروژه تاثیری نخواهد گذاشت.

یک نقطه را به عنوان لامپ در نظر می گیریم. بردار عمود به هر مثلث را به دست می آوریم و رنگ
هر نقطه را در کسینوس زاویه بین خط عمود و خط واصل لامپ و نقطه ضرب می کنیم. یک عدد ثابت به
این ضریب اضافه می کنیم (که به عنوان نور محیط شناخته می شود) تا نقاطی که زیر
پوشش لامپ نیستند سیاه نشوند.

